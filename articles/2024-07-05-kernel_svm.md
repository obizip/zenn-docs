---
title: "ã‚«ãƒ¼ãƒãƒ«SVMã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«å®Ÿè£…ã™ã‚‹"
emoji: "ğŸ“"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Python", "SVM", "æ©Ÿæ¢°å­¦ç¿’", "æ•°ç†æœ€é©åŒ–"]
published: false
---

## TL;DR
- ç·šå½¢SVMã¨åŒæ§˜ã«ã€ã‚«ãƒ¼ãƒãƒ«SVMã‚’å®Ÿè£…ã—ã¦ã„ã‚‹è¨˜äº‹ã‚‚ã‚ã¾ã‚Šè¦‹ã‹ã‘ãªã‹ã£ãŸã®ã§pythonã§å®Ÿè£…ã—ã¦ã¿ã¾ã—ãŸã€‚
- ã‚«ãƒ¼ãƒãƒ«SVMã®ä¸»å•é¡Œã‚’ã€L2æ­£å‰‡åŒ–çµŒé¨“ãƒªã‚¹ã‚¯æœ€å°åŒ–å•é¡Œã¨ã—ã¦å‹¾é…é™ä¸‹æ³•ã§è§£ãã¾ã™ã€‚
- è¨ˆç®—é€Ÿåº¦ã¯scikit-learnã®SVCã®ã‚ˆã†ãªå·¥å¤«ã•ã‚ŒãŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã¯åŠã³ã¾ã›ã‚“ã€‚

## æœ¬è¨˜äº‹ãŒå®Ÿè£…ã™ã‚‹SVM
å‰å›ã®ç·šå½¢SVMã®å†…å®¹ã‚’å‰æã¨ã—ã¦é€²ã‚ãŸã„ã¨æ€ã„ã¾ã™ã€‚
2ã‚¯ãƒ©ã‚¹åˆ†é¡ã‚’è¡Œã†ã€ã‚«ãƒ¼ãƒãƒ«SVMã®å®Ÿè£…ã‚’è¡Œã„ã¾ã™ã€‚
å®Ÿè£…ã¯ã“ã¡ã‚‰ã«ã‚ã‚Šã¾ã™ã€‚
@[card](https://github.com/obizip/SVM)

## å‰å›ã®è¨˜äº‹ã®æŒ¯ã‚Šè¿”ã‚Š
:::message
ç°¡å˜ã®ãŸã‚ã«ç‰¹å¾´é‡$\bm{x}$ã¨é‡ã¿$\bm{w}$ã‚’æ¬¡ã®ã‚ˆã†ã«æ‹¡å¼µã—ã¾ã™ã€‚
$$\tilde{\bm{x}} = [\bm{x}, 1]^\top, \tilde{\bm{w}} = [\bm{w}, b]$$
**ä»¥ä¸‹ã§ã¯å˜ã«$\tilde{\bm{x}}$ã‚’$\bm{x}$ã€$\tilde{\bm{w}}$ã‚’$\bm{w}$ã¨è¡¨è¨˜ã—ã¾ã™ã€‚**
ã¾ãŸã€ç‰¹å¾´é‡ã‚’$\bm{x}_1, \cdots, \bm{x}_n \in \mathbb{R}^d$ã€ã‚¯ãƒ©ã‚¹ãƒ©ãƒ™ãƒ«ã‚’$y_1, \cdots, y_n \in \{-1, 1\}$ã¨ã—ã¾ã™ã€‚
:::

### ç·šå½¢SVM
ã“ã“ã§ã€ç·šå½¢åˆ†é›¢ä¸å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«å¯¾ã—ã¦ã€$\xi$ã ã‘åˆ†é¡å¢ƒç•Œã‹ã‚‰ã®èª¤å·®ã‚’è¨±å®¹ã™ã‚‹ã‚ˆã†ã«ãƒãƒ¼ãƒ‰ãƒãƒ¼ã‚¸ãƒ³SVMã‚’ä¸€èˆ¬åŒ–ã—ãŸæ‰‹æ³•ã‚’[ã‚½ãƒ•ãƒˆãƒãƒ¼ã‚¸ãƒ³SVM](https://ja.wikipedia.org/wiki/%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%83%99%E3%82%AF%E3%82%BF%E3%83%BC%E3%83%9E%E3%82%B7%E3%83%B3#%E3%82%BD%E3%83%95%E3%83%88%E3%83%9E%E3%83%BC%E3%82%B8%E3%83%B3)ã¨å‘¼ã³ã¾ã™ã€‚
åŸºæœ¬çš„ãªã‚½ãƒ•ãƒˆãƒãƒ¼ã‚¸ãƒ³SVMã¯$\bm{y}_i \langle \bm{w}, \bm{x_i} \rangle = 0$ã§è¡¨ã•ã‚Œã‚‹ã‚ˆã†ãªä¸€æ¬¡é–¢æ•°ã§ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’åˆ†é›¢ã™ã‚‹ãŸã‚**ç·šå½¢SVM**ã¨ã‚‚å‘¼ã°ã‚Œã¾ã™ã€‚

### ä¸»å•é¡Œ

å®šæ•°$\lambda \in \mathbb{R}$ã¨ã—ã¦ã€ç·šå½¢SVMã®ä¸»å•é¡Œã¯æ¬¡ã®ã‚ˆã†ã«è¡¨ã›ã¾ã™ã€‚

$$\min_w{\frac{\lambda}{2}||\bm{w}||^2 + \frac{1}{n}\sum^n_{i=1}\xi_i} \quad \text{s.t.} \quad \xi_i \ge 0, \quad \bm{y}_i \langle \bm{w}, \bm{x_i} \rangle \ge 1 - \xi_i$$

### çµŒé¨“ãƒªã‚¹ã‚¯æœ€å°åŒ–
ç·šå½¢SVMã®ä¸»å•é¡Œã¯çµŒé¨“ãƒªã‚¹ã‚¯$R$ã‚’ç”¨ã„ã¦æ¬¡ã®ã‚ˆã†ã«ã€ãƒ’ãƒ³ã‚¸æå¤±ã«ã‚ˆã‚‹L2æ­£å‰‡åŒ–çµŒé¨“ãƒªã‚¹ã‚¯æœ€å°åŒ–å•é¡Œã¨ã—ã¦è¡¨ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

$$\begin{gather*}\min_w{R(\bm{w})}\\ \text{where} \quad R(\bm{w}) := \frac{\lambda}{2}||\bm{w}||^2 + \frac{1}{n}\sum^n_{i=1}\max\{0, 1-y_i \langle \bm{w}, \bm{x_i} \rangle \}\end{gather*}$$

### ç·šå½¢SVMã®é™ç•Œ
ã“ã®ç·šå½¢SVMã§ã€æ¬¡ã®ã‚ˆã†ãªmoonãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’äºˆæ¸¬ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®åˆ†å¸ƒã«æ²¿ã£ãŸå¢ƒç•Œã«ã¯ãªã£ã¦ã„ã¾ã›ã‚“ã€‚
ã“ã®ã‚ˆã†ã«ã€ä¸Šã§æ‰±ã£ãŸä¸€æ¬¡é–¢æ•°ã§åˆ†é›¢ã™ã‚‹SVM(ç·šå½¢SVM)ã§ã¯é™ç•ŒãŒã‚ã‚Šã¾ã™ã€‚
![dataset_moon](/images/2024-07-04-linear_svm/dataset_moon.png)

## ã‚«ãƒ¼ãƒãƒ«SVMã¨ã¯
ç‰¹å¾´é‡$\bm{x}$ã‚’ç‰¹å¾´å†™åƒ$\Phi$ã«ã‚ˆã£ã¦é«˜æ¬¡å…ƒãªç‰¹å¾´ç©ºé–“ã«å†™ã—ã€ã“ã®é«˜æ¬¡å…ƒç©ºé–“ä¸Šã§ä¸€æ¬¡é–¢æ•°ã«ã‚ˆã‚Šåˆ†é¡ã‚’è¡Œã†æ–¹æ³•ã‚’**ã‚«ãƒ¼ãƒãƒ«SVM**ã¨å‘¼ã³ã¾ã™ã€‚

ç›´æ„Ÿçš„ã«ã¯ã€ãƒ‡ãƒ¼ã‚¿ã®ç‰¹å¾´é‡ã‚’é«˜æ¬¡å…ƒã«å†™ã™ã“ã¨ã§ã€è¡¨ç¾åŠ›ãŒå¢—ã—ã€ã‚ˆã‚Šåˆ†é¡ã—ã‚„ã™ããªã‚Šãã†ã§ã™ã€‚ã—ã‹ã—ã€ç‰¹å¾´ç©ºé–“ã®æ¬¡å…ƒãŒå¤§ãã‘ã‚Œã°å¤§ãã„ã»ã©ã€ãã®ç©ºé–“ã§ã®ç‰¹å¾´é‡$\Phi(\bm{x})$ã®æ¬¡å…ƒã‚‚å¤§ãããªã‚Šã€è¨ˆç®—ã«ã‚³ã‚¹ãƒˆãŒã‹ã‹ã£ã¦ã—ã¾ã„ã¾ã™ã€‚

ã“ã“ã§ã€ç‰¹æ®Šãªé–¢æ•°ã§ã‚ã‚‹**ã‚«ãƒ¼ãƒãƒ«é–¢æ•°**$\kappa$ã¨å‘¼ã°ã‚Œã‚‹2å¤‰æ•°é–¢æ•°ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã€ç‰¹å¾´ç©ºé–“ä¸­ã®ç‰¹å¾´é‡ã®**æ˜ç¤ºçš„ãªè¨ˆç®—ã‚’çµŒç”±ã›ãš**ã«ã€ç‰¹å¾´ç©ºé–“ã«ãŠã‘ã‚‹**å†…ç©ã‚’ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ç›´æ¥è¨ˆç®—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™**(ã“ã®ã“ã¨ã‚’**ã‚«ãƒ¼ãƒãƒ«ãƒˆãƒªãƒƒã‚¯**ã¨ã„ã„ã¾ã™)ã€‚
ä»Šå›ã¯ã€æ¬¡ã®ã‚ˆã†ã«ã‚«ãƒ¼ãƒãƒ«é–¢æ•°ãŒè¡¨ã•ã‚Œã‚‹ã¨ã—ã¾ã™ã€‚
$$\kappa(\bm{u}, \bm{v}) = \left\langle\Phi(\bm{u}), \Phi(\bm{v})\right\rangle$$

## ã‚«ãƒ¼ãƒãƒ«SVMã®çµŒé¨“ãƒªã‚¹ã‚¯é–¢æ•°
ç·šå½¢SVMã®çµŒé¨“ãƒªã‚¹ã‚¯$R$ã¯æ¬¡ã®ã‚ˆã†ã§ã—ãŸã€‚
$$R(\bm{w}) := \frac{\lambda}{2}||\bm{w}||^2 + \frac{1}{n}\sum^n_{i=1}\max\{0, 1-y_i \langle \bm{w}, \bm{x_i} \rangle \}$$
ä»Šã€ç‰¹å¾´é‡$\bm{x}_i$ã‚’ã€ç‰¹å¾´å†™åƒ$\Phi$ã«ã‚ˆã£ã¦é«˜æ¬¡å…ƒãªç‰¹å¾´ç©ºé–“ã«å†™ã—ãŸ$\Phi(\bm{x}_i)$ã¨ã—ã¦è¨ˆç®—ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã¾ã™ã€‚ã™ã‚‹ã¨ã€ä¸Šå¼ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
$$R(\bm{w}) := \frac{\lambda}{2}||\bm{w}||^2 + \frac{1}{n}\sum^n_{i=1}\max\{0, 1-y_i \langle \bm{w}, \Phi(\bm{x_i}) \rangle\}$$
ã“ã®ã¾ã¾ã€å‰å›ã®ç·šå½¢SVMã¨åŒæ§˜ã«å‹¾é…é™ä¸‹æ³•ã‚’ç”¨ã„ã¦è§£ãã“ã¨ãŒã§ãã‚Œã°ã‚ˆã„ã®ã§ã™ãŒã€ä¸Šã§è¿°ã¹ãŸé€šã‚Šã€é«˜æ¬¡å…ƒç©ºé–“ã§ã®ç‰¹å¾´é‡$\Phi(\bm{x}_i)$ã®è¨ˆç®—ã«ã¯ã€å¤§ããªã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚Šã¾ã™ã€‚

ã“ã“ã§ã€ä¸€èˆ¬çš„ã«ã¯åŒå¯¾å•é¡Œã‚’è€ƒãˆã¾ã™ãŒã€ä»Šå›ã¯åˆ¥ã®æ‰‹æ³•ã‚’ã¨ã‚Šã¾ã™ã€‚
ã“ã®çµŒé¨“ãƒªã‚¹ã‚¯$R$ã®é‡ã¿$\bm{w}$ã¯ã€**ãƒªãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼å®šç†**ã‚’ç”¨ã„ã¦æ¬¡ã®ã‚ˆã†ã«è¡¨ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

$\bm{\alpha} = [\alpha_1, ..., \alpha_n] \in \mathbb{R}^n$ã‚’ç”¨ã„ã¦$\bm{w}$ã‚’æ¬¡ã®ã‚ˆã†ã«è¡¨ã™ã“ã¨ãŒã§ãã‚‹ã€‚
$$\bm{w} = \sum^n_{j=1} \alpha_j\Phi(\bm{x}_j)$$
ã“ã‚Œã‚’è¸ã¾ãˆã‚‹ã¨çµŒé¨“ãƒªã‚¹ã‚¯$R$ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚‹.

ãŸã ã—ã€$K = [\bm{k}_1, ..., \bm{k}_n] = [\kappa(\bm{x}_i, \bm{x}_j)]_{i, j},~\quad i, j \in [n]$ã¨ã™ã‚‹ã€‚

$$\begin{align*}
	R(\bm{\alpha}) & = \frac{\lambda}{2} \left\|\sum^n_{j=1} \alpha_j\Phi(\bm{x}_j)\right\|^2 + \frac{1}{n}\sum^n_{i=1} \max\left\{0, 1- y_i\left\langle\sum^n_{j=1} \alpha_j\Phi(\bm{x}_j), \Phi(\bm{x}_i)\right\rangle\right\} \\
	           & = \frac{\lambda}{2}\left\|\sum^n_{j=1} \alpha_j\Phi(\bm{x}_j)\right\|^2
	+ \frac{1}{n}\sum^n_{i=1} \max\left\{0, 1-y_i\sum^n_{j=1} \alpha_j\left\langle\Phi(\bm{x}_j), \Phi(\bm{x}_i)\right\rangle \right\} \\
	           & = \frac{\lambda}{2}\left\langle\sum^n_{i=1} \Phi(\bm{x}_i)\alpha_i, \sum^n_{j=1} \Phi(\bm{x}_j)\alpha_j\right\rangle
	+ \frac{1}{n}\sum^n_{i=1} \max\left\{0, 1-y_i \alpha_j \sum^n_{j=1}\left\langle\Phi(\bm{x}_j), \Phi(\bm{x}_i)\right\rangle\right\} \\
	           & = \frac{\lambda}{2}\sum^n_{i=1}\sum^n_{j=1}\alpha_i\left\langle \Phi(\bm{x}_i),  \Phi(\bm{x}_j)\right\rangle\alpha_j
	+ \frac{1}{n}\sum^n_{i=1} \max\left\{0, 1-y_i \alpha_j \sum^n_{j=1}\left\langle\Phi(\bm{x}_j), \Phi(\bm{x}_i)\right\rangle\right\} \\
	           & = \frac{\lambda}{2}\sum^n_{i=1}\sum^n_{j=1}\alpha_i\kappa(\bm{x}_i, \bm{x}_j)\alpha_j
	+ \frac{1}{n}\sum^n_{i=1} \max\left\{0, 1-y_i \alpha_j \sum^n_{j=1}\kappa(\bm{x}_j, \bm{x}_i)\right\}          \\
	           & = \frac{\lambda}{2}\left\langle\bm{\alpha}, K \bm{\alpha}\right\rangle
	+ \frac{1}{n}\sum^n_{i=1} \max\left\{0, 1-y_i\left\langle\bm{\alpha}, \bm{k}_i\right\rangle\right\}
\end{align*}$$

ã‚ˆã£ã¦çµŒé¨“ãƒªã‚¹ã‚¯$R$ã®å‹¾é…ã‚’è¨ˆç®—ã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚‹ã€‚

$$\begin{align*}
    \nabla R(\bm{\alpha}) & = \lambda K \bm{\alpha}
    + \frac{1}{n}\sum^n_{i=1} \begin{cases} -y_i\bm{k}_i &\text{if } 1-y_i \langle \bm{\alpha}, \bm{k}_i \rangle \ge 0 \\ 0 &\text{otherwise}\end{cases} \\
\end{align*}$$

### çµŒé¨“ãƒªã‚¹ã‚¯æœ€å°åŒ–ã¨æœ€æ€¥é™ä¸‹æ³•
ç·šå½¢SVMã¨åŒæ§˜ã«ã€çµŒé¨“ãƒªã‚¹ã‚¯$R$ãŒ[å‡¸é–¢æ•°](https://ja.wikipedia.org/wiki/%E5%87%B8%E9%96%A2%E6%95%B0)ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ã€å˜ç´”ã«[æœ€æ€¥é™ä¸‹æ³•](https://ja.wikipedia.org/wiki/%E6%9C%80%E6%80%A5%E9%99%8D%E4%B8%8B%E6%B3%95)ã‚’ç”¨ã„ã‚‹ã“ã¨ã§æœ€é©è§£ã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã¤ã¾ã‚Šã€$t$ã‚¹ãƒ†ãƒƒãƒ—ç›®ã®é‡ã¿$\bm{\alpha}^{(t)}$ã¯ã€å­¦ç¿’ç‡$\eta \in \mathbb{R}$ã‚’å®šã‚ã¦ã€å‰ã‚¹ãƒ†ãƒƒãƒ—ã®é‡ã¿$\bm{\alpha}^{(t-1)}$ã¨ã€çµŒé¨“ãƒªã‚¹ã‚¯$R$ã®å‹¾é…ã‹ã‚‰ã€æ¬¡ã®ã‚ˆã†ã«æ±ºã‚ã¦ã„ã‘ã°è‰¯ã„ã“ã¨ã«ãªã‚Šã¾ã™ã€‚
$$\bm{\alpha}^{(t)} = \bm{\alpha}^{(t-1)} - \eta \nabla R(\bm{\alpha}^{(t-1)})$$
ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ååˆ†ã«ç¹°ã‚Šè¿”ã™ã“ã¨ã§ã€é‡ã¿$\bm{\alpha}$ã¯çµŒé¨“ãƒªã‚¹ã‚¯$R$ã‚’æœ€å°ã¨ã™ã‚‹æœ€é©è§£ã«è¿‘ã¥ã„ã¦ã„ãã¾ã™ã€‚

### ã‚«ãƒ¼ãƒãƒ«SVMã§ã®äºˆæ¸¬
ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿$\tilde{\bm{x}}_1, \cdots, \tilde{\bm{x}}_m \in \mathbb{R}^d$ã«å¯¾ã—ã¦ã€å‹¾é…é™ä¸‹æ³•ã§å¾—ãŸ$\alpha$ã‚’ç”¨ã„ã¦äºˆæ¸¬å€¤ã‚’è¨ˆç®—ã™ã‚‹ã«ã¯æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚ ãŸã ã—ã€$\tilde{K} = [\tilde{\bm{k}}_1, ..., \tilde{\bm{k}}_m] = [\kappa(\bm{x}_i, \tilde{\bm{x}}_j)]_{i, j}, \quad (i, j) \in [n]\times[m]$ã¨ã—ã¾ã™ã€‚

$$\begin{align*}
	i \in [m], \quad \hat{\bm{y}} & = [\left\langle\bm{w}, \Phi(\tilde{\bm{x}}_i)\right\rangle]_i                                                            \\
	                          & = \left[\left\langle\sum^n_{j=1}\alpha_j \Phi(\bm{x}_j) , \Phi(\tilde{\bm{x}}_i)\right\rangle\right]_i \\
	                          & = \left[\sum^n_{j=1} \alpha_j\left\langle\Phi(\bm{x}_j), \Phi(\tilde{\bm{x}}_i)\right\rangle \right]_i \\
	                          & = \left[\left\langle\bm{\alpha}, \tilde{\bm{k}}_i\right\rangle\right]_i                               \\
\end{align*}$$
